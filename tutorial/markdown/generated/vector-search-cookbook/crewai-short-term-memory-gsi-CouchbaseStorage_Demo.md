---
# frontmatter
path: "/tutorial-crewai-short-term-memory-couchbase-with-global-secondary-index"
title: Implementing Short-Term Memory for CrewAI Agents with Couchbase with GSI
short_title: CrewAI Short-Term Memory with Couchbase with GSI
description:
  - Learn how to implement short-term memory for CrewAI agents using Couchbase's vector search capabilities with GSI.
  - This tutorial demonstrates how to store and retrieve agent interactions using semantic search.
  - You'll understand how to enhance CrewAI agents with memory capabilities using LangChain and Couchbase.
content_type: tutorial
filter: sdk
technology:
  - vector search
tags:
  - Artificial Intelligence
  - LangChain
  - CrewAI
sdk_language:
  - python
length: 45 Mins
---


<!--- *** WARNING ***: Autogenerated markdown file from jupyter notebook. ***DO NOT EDIT THIS FILE***. Changes should be made to the original notebook file. See commit message for source repo. -->


[View Source](https://github.com/couchbase-examples/vector-search-cookbook/tree/main/crewai-short-term-memory/gsi/CouchbaseStorage_Demo.ipynb)

# CrewAI Short-Term Memory with Couchbase GSI Vector Search

## Overview

This tutorial shows how to implement a custom memory backend for CrewAI agents using Couchbase's high-performance GSI (Global Secondary Index) vector search. CrewAI agents can retain and recall information across interactions, making them more contextually aware and effective. We'll demonstrate measurable performance improvements with GSI optimization.

**Key Features:**
- Custom CrewAI memory storage with Couchbase GSI vector search
- High-performance semantic memory retrieval
- Agent memory persistence across conversations
- Performance benchmarks showing GSI benefits

**Requirements:** Couchbase Server 8.0+ or Capella with Query Service enabled.

## Prerequisites

### Couchbase Setup

1. **Create Capella Account:** Deploy a [free tier cluster](https://cloud.couchbase.com/sign-up)
2. **Enable Query Service:** Required for GSI vector search
3. **Configure Access:** Set up database credentials and network security
4. **Create Bucket:** Manual bucket creation recommended for Capella

## Understanding Agent Memory

### Why Memory Matters for AI Agents

Memory in AI agents is a crucial capability that allows them to retain and utilize information across interactions, making them more effective and contextually aware. Without memory, agents would be limited to processing only the immediate input, lacking the ability to build upon past experiences or maintain continuity in conversations.

#### Types of Memory in AI Agents

**Short-term Memory:**
- Retains recent interactions and context
- Typically spans the current conversation or session  
- Helps maintain coherence within a single interaction flow
- In CrewAI, this is what we're implementing with the Couchbase storage

**Long-term Memory:**
- Stores persistent knowledge across multiple sessions
- Enables agents to recall past interactions even after long periods
- Helps build cumulative knowledge about users, preferences, and past decisions
- While this implementation is labeled as "short-term memory", the Couchbase storage backend can be effectively used for long-term memory as well, thanks to Couchbase's persistent storage capabilities and enterprise-grade durability features

#### How Memory Works in Agents

Memory in AI agents typically involves:
- **Storage**: Information is encoded and stored in a database (like Couchbase, ChromaDB, or other vector stores)
- **Retrieval**: Relevant memories are fetched based on semantic similarity to current context
- **Integration**: Retrieved memories are incorporated into the agent's reasoning process

The vector-based approach (using embeddings) is particularly powerful because it allows for semantic search - finding memories that are conceptually related to the current context, not just exact keyword matches.

#### Benefits of Memory in AI Agents

- **Contextual Understanding**: Agents can refer to previous parts of a conversation
- **Personalization**: Remembering user preferences and past interactions
- **Learning and Adaptation**: Building knowledge over time to improve responses
- **Task Continuity**: Resuming complex tasks across multiple interactions
- **Collaboration**: In multi-agent systems like CrewAI, memory enables agents to build on each other's work

#### Memory in CrewAI Specifically

In CrewAI, memory serves several important functions:
- **Agent Specialization**: Each agent can maintain its own memory relevant to its expertise
- **Knowledge Transfer**: Agents can share insights through memory when collaborating on tasks
- **Process Continuity**: In sequential processes, later agents can access the work of earlier agents
- **Contextual Awareness**: Agents can reference previous findings when making decisions

## Setup and Installation

### Install Required Libraries

Install the necessary packages for CrewAI, Couchbase integration, and OpenAI embeddings.


```python
%pip install --quiet crewai==0.186.1 langchain-couchbase==0.5.0 langchain-openai==0.3.33 python-dotenv==1.1.1
```

    Note: you may need to restart the kernel to use updated packages.


### Import Required Modules

Import libraries for CrewAI memory storage, Couchbase GSI vector search, and OpenAI embeddings.


```python
from typing import Any, Dict, List, Optional
import os
import logging
from datetime import timedelta
from dotenv import load_dotenv
from crewai.memory.storage.rag_storage import RAGStorage
from crewai.memory.short_term.short_term_memory import ShortTermMemory
from crewai import Agent, Crew, Task, Process
from couchbase.cluster import Cluster
from couchbase.options import ClusterOptions
from couchbase.auth import PasswordAuthenticator
from couchbase.diagnostics import PingState, ServiceType
from langchain_couchbase.vectorstores import CouchbaseQueryVectorStore
from langchain_couchbase.vectorstores import DistanceStrategy
from langchain_couchbase.vectorstores import IndexType
from langchain_openai import OpenAIEmbeddings, ChatOpenAI
import time
import json
import uuid

# Configure logging (disabled)
logging.basicConfig(level=logging.CRITICAL)
logger = logging.getLogger(__name__)
```

### Environment Configuration

Configure environment variables for secure access to Couchbase and OpenAI services. Create a `.env` file with your credentials.


```python
load_dotenv("./.env")

# Verify environment variables
required_vars = ['OPENAI_API_KEY', 'CB_HOST', 'CB_USERNAME', 'CB_PASSWORD']
for var in required_vars:
    if not os.getenv(var):
        raise ValueError(f"{var} environment variable is required")
```

## Understanding GSI Vector Search

### GSI Vector Index Types

Couchbase offers two types of GSI vector indexes for different use cases:

**Hyperscale Vector Indexes (BHIVE):**
- Best for pure vector searches - content discovery, recommendations, semantic search
- High performance with low memory footprint - designed to scale to billions of vectors
- Optimized for concurrent operations - supports simultaneous searches and inserts
- Use when: You primarily perform vector-only queries without complex scalar filtering
- Ideal for: Large-scale semantic search, recommendation systems, content discovery

**Composite Vector Indexes:**
- Best for filtered vector searches - combines vector search with scalar value filtering
- Efficient pre-filtering - scalar attributes reduce the vector comparison scope
- Use when: Your queries combine vector similarity with scalar filters that eliminate large portions of data
- Ideal for: Compliance-based filtering, user-specific searches, time-bounded queries

For this CrewAI memory implementation, we'll use **BHIVE** as it's optimized for pure semantic search scenarios typical in AI agent memory systems.

### Understanding Index Configuration

The `index_description` parameter controls how Couchbase optimizes vector storage and search performance through centroids and quantization:

**Format**: `'IVF[<centroids>],{PQ|SQ}<settings>'`

**Centroids (IVF - Inverted File):**
- Controls how the dataset is subdivided for faster searches
- More centroids = faster search, slower training  
- Fewer centroids = slower search, faster training
- If omitted (like IVF,SQ8), Couchbase auto-selects based on dataset size

**Quantization Options:**
- SQ (Scalar Quantization): SQ4, SQ6, SQ8 (4, 6, or 8 bits per dimension)
- PQ (Product Quantization): PQ<subquantizers>x<bits> (e.g., PQ32x8)
- Higher values = better accuracy, larger index size

**Common Examples:**
- IVF,SQ8 - Auto centroids, 8-bit scalar quantization (good default)
- IVF1000,SQ6 - 1000 centroids, 6-bit scalar quantization  
- IVF,PQ32x8 - Auto centroids, 32 subquantizers with 8 bits

For detailed configuration options, see the [Quantization & Centroid Settings](https://docs.couchbase.com/cloud/vector-index/hyperscale-vector-index.html#algo_settings).

For more information on GSI vector indexes, see [Couchbase GSI Vector Documentation](https://docs.couchbase.com/cloud/vector-index/use-vector-indexes.html).


## Custom CouchbaseStorage Implementation

### CouchbaseStorage Class

This class extends CrewAI's `RAGStorage` to provide GSI vector search capabilities for agent memory.


```python
class CouchbaseStorage(RAGStorage):
    """
    Extends RAGStorage to handle embeddings for memory entries using Couchbase GSI Vector Search.
    """

    def __init__(self, type: str, allow_reset: bool = True, embedder_config: Optional[Dict[str, Any]] = None, crew: Optional[Any] = None):
        """Initialize CouchbaseStorage with GSI vector search configuration."""
        super().__init__(type, allow_reset, embedder_config, crew)
        self._initialize_app()

    def search(
        self,
        query: str,
        limit: int = 3,
        filter: Optional[dict] = None,
        score_threshold: float = 0,
    ) -> List[Dict[str, Any]]:
        """
        Search memory entries using GSI vector similarity.
        """
        try:
            # Add type filter
            search_filter = {"memory_type": self.type}
            if filter:
                search_filter.update(filter)

            # Execute search using GSI vector search
            results = self.vector_store.similarity_search_with_score(
                query,
                k=limit,
                filter=search_filter
            )
            
            # Format results and deduplicate by content
            seen_contents = set()
            formatted_results = []
            
            for i, (doc, distance) in enumerate(results):
                # Note: In GSI vector search, lower distance indicates higher similarity
                if distance <= (1.0 - score_threshold):  # Convert threshold for GSI distance metric
                    content = doc.page_content
                    if content not in seen_contents:
                        seen_contents.add(content)
                        formatted_results.append({
                            "id": doc.metadata.get("memory_id", str(i)),
                            "metadata": doc.metadata,
                            "context": content,
                            "distance": float(distance)  # Changed from score to distance
                        })
            
            logger.info(f"Found {len(formatted_results)} unique results for query: {query}")
            return formatted_results

        except Exception as e:
            logger.error(f"Search failed: {str(e)}")
            return []

    def save(self, value: Any, metadata: Dict[str, Any]) -> None:
        """
        Save a memory entry with metadata.
        """
        try:
            # Generate unique ID
            memory_id = str(uuid.uuid4())
            timestamp = int(time.time() * 1000)
            
            # Prepare metadata (create a copy to avoid modifying references)
            if not metadata:
                metadata = {}
            else:
                metadata = metadata.copy()  # Create a copy to avoid modifying references
                
            # Process agent-specific information if present
            agent_name = metadata.get('agent', 'unknown')
                
            # Clean up value if it has the typical LLM response format
            value_str = str(value)
            if "Final Answer:" in value_str:
                # Extract just the actual content - everything after "Final Answer:"
                parts = value_str.split("Final Answer:", 1)
                if len(parts) > 1:
                    value = parts[1].strip()
                    logger.info(f"Cleaned up response format for agent: {agent_name}")
            elif value_str.startswith("Thought:"):
                # Handle thought/final answer format
                if "Final Answer:" in value_str:
                    parts = value_str.split("Final Answer:", 1)
                    if len(parts) > 1:
                        value = parts[1].strip()
                        logger.info(f"Cleaned up thought process format for agent: {agent_name}")
            
            # Update metadata
            metadata.update({
                "memory_id": memory_id,
                "memory_type": self.type,
                "timestamp": timestamp,
                "source": "crewai"
            })

            # Log memory information for debugging
            value_preview = str(value)[:100] + "..." if len(str(value)) > 100 else str(value)
            metadata_preview = {k: v for k, v in metadata.items() if k != "embedding"}
            logger.info(f"Saving memory for Agent: {agent_name}")
            logger.info(f"Memory value preview: {value_preview}")
            logger.info(f"Memory metadata: {metadata_preview}")
            
            # Convert value to string if needed
            if isinstance(value, (dict, list)):
                value = json.dumps(value)
            elif not isinstance(value, str):
                value = str(value)

            # Save to GSI vector store
            self.vector_store.add_texts(
                texts=[value],
                metadatas=[metadata],
                ids=[memory_id]
            )
            logger.info(f"Saved memory {memory_id}: {value[:100]}...")

        except Exception as e:
            logger.error(f"Save failed: {str(e)}")
            raise

    def reset(self) -> None:
        """Reset the memory storage if allowed."""
        if not self.allow_reset:
            return

        try:
            # Delete documents of this memory type
            self.cluster.query(
                f"DELETE FROM `{self.bucket_name}`.`{self.scope_name}`.`{self.collection_name}` WHERE memory_type = $type",
                type=self.type
            ).execute()
            logger.info(f"Reset memory type: {self.type}")
        except Exception as e:
            logger.error(f"Reset failed: {str(e)}")
            raise

    def _initialize_app(self):
        """Initialize Couchbase connection and GSI vector store."""
        try:
            # Initialize embeddings
            if self.embedder_config and self.embedder_config.get("provider") == "openai":
                self.embeddings = OpenAIEmbeddings(
                    openai_api_key=os.getenv('OPENAI_API_KEY'),
                    model=self.embedder_config.get("config", {}).get("model", "text-embedding-3-small")
                )
            else:
                self.embeddings = OpenAIEmbeddings(
                    openai_api_key=os.getenv('OPENAI_API_KEY'),
                    model="text-embedding-3-small"
                )

            # Connect to Couchbase
            auth = PasswordAuthenticator(
                os.getenv('CB_USERNAME', ''),
                os.getenv('CB_PASSWORD', '')
            )
            options = ClusterOptions(auth)
            
            # Initialize cluster connection
            self.cluster = Cluster(os.getenv('CB_HOST', ''), options)
            self.cluster.wait_until_ready(timedelta(seconds=5))

            # Check Query service (required for GSI vector search)
            ping_result = self.cluster.ping()
            query_available = False
            for service_type, endpoints in ping_result.endpoints.items():
                if service_type.name == 'Query':  # Query Service for GSI
                    for endpoint in endpoints:
                        if endpoint.state == PingState.OK:
                            query_available = True
                            logger.info(f"Query service is responding at: {endpoint.remote}")
                            break
                    break
            if not query_available:
                raise RuntimeError("Query service not found or not responding. GSI vector search requires Query Service.")
            
            # Set up storage configuration
            self.bucket_name = os.getenv('CB_BUCKET_NAME', 'vector-search-testing')
            self.scope_name = os.getenv('SCOPE_NAME', 'shared')
            self.collection_name = os.getenv('COLLECTION_NAME', 'crew')
            self.index_name = os.getenv('INDEX_NAME', 'vector_search_crew_gsi')

            # Initialize GSI vector store
            self.vector_store = CouchbaseQueryVectorStore(
                cluster=self.cluster,
                bucket_name=self.bucket_name,
                scope_name=self.scope_name,
                collection_name=self.collection_name,
                embedding=self.embeddings,
                distance_metric=DistanceStrategy.COSINE,
            )
            logger.info(f"Initialized CouchbaseStorage with GSI vector search for type: {self.type}")

        except Exception as e:
            logger.error(f"Initialization failed: {str(e)}")
            raise
```

## Memory Search Performance Testing

Now let's demonstrate the performance benefits of GSI optimization by testing pure memory search performance. We'll compare three optimization levels:

1. **Baseline Performance**: Memory search without GSI optimization
2. **GSI-Optimized Performance**: Same search with BHIVE GSI index
3. **Cache Benefits**: Show how caching can be applied on top of GSI for repeated queries

**Important**: This testing focuses on pure memory search performance, isolating the GSI improvements from CrewAI agent workflow overhead.

### Initialize Storage and Test Functions

First, let's set up the storage and create test functions for measuring memory search performance.


```python
# Initialize storage
storage = CouchbaseStorage(
    type="short_term",
    embedder_config={
        "provider": "openai",
        "config": {"model": "text-embedding-3-small"}
    }
)

# Reset storage
storage.reset()

# Test storage
test_memory = "Pep Guardiola praised Manchester City's current form, saying 'The team is playing well, we are in a good moment. The way we are training, the way we are playing - I am really pleased.'"
test_metadata = {"category": "sports", "test": "initial_memory"}
storage.save(test_memory, test_metadata)

import time

def test_memory_search_performance(storage, query, label="Memory Search"):
    """Test pure memory search performance and return timing metrics"""
    print(f"\n[{label}] Testing memory search performance")
    print(f"[{label}] Query: '{query}'")
    
    start_time = time.time()
    
    try:
        results = storage.search(query, limit=3)
        end_time = time.time()
        search_time = end_time - start_time
        
        print(f"[{label}] Memory search completed in {search_time:.4f} seconds")
        print(f"[{label}] Found {len(results)} memories")
        
        if results:
            print(f"[{label}] Top result distance: {results[0]['distance']:.6f} (lower = more similar)")
            preview = results[0]['context'][:100] + "..." if len(results[0]['context']) > 100 else results[0]['context']
            print(f"[{label}] Top result preview: {preview}")
        
        return search_time
    except Exception as e:
        print(f"[{label}] Memory search failed: {str(e)}")
        return None
```

### Test 1: Baseline Performance (No GSI Index)

Test pure memory search performance without GSI optimization.


```python
# Test baseline memory search performance without GSI index
test_query = "What did Guardiola say about Manchester City?"
print("Testing baseline memory search performance without GSI optimization...")
baseline_time = test_memory_search_performance(storage, test_query, "Baseline Search")
print(f"\nBaseline memory search time (without GSI): {baseline_time:.4f} seconds\n")
```

    Testing baseline memory search performance without GSI optimization...
    
    [Baseline Search] Testing memory search performance
    [Baseline Search] Query: 'What did Guardiola say about Manchester City?'
    [Baseline Search] Memory search completed in 0.6159 seconds
    [Baseline Search] Found 1 memories
    [Baseline Search] Top result distance: 0.340130 (lower = more similar)
    [Baseline Search] Top result preview: Pep Guardiola praised Manchester City's current form, saying 'The team is playing well, we are in a ...
    
    Baseline memory search time (without GSI): 0.6159 seconds
    


### Create BHIVE GSI Index

Now let's create a BHIVE GSI vector index to enable high-performance memory searches. The index creation is done programmatically through the vector store.


```python
# Create GSI BHIVE vector index for optimal performance
print("Creating BHIVE GSI vector index...")
try:
    storage.vector_store.create_index(
        index_type=IndexType.BHIVE,
        # index_type=IndexType.COMPOSITE,  # Uncomment this line to create a COMPOSITE index instead
        index_name=storage.index_name,
        index_description="IVF,SQ8"  # Auto-selected centroids with 8-bit scalar quantization
    )
    print(f"GSI Vector index created successfully: {storage.index_name}")
    
    # Wait for index to become available
    print("Waiting for index to become available...")
    time.sleep(5)
    
except Exception as e:
    if "already exists" in str(e).lower():
        print(f"GSI vector index '{storage.index_name}' already exists, proceeding...")
    else:
        print(f"Error creating GSI index: {str(e)}")
```

    Creating BHIVE GSI vector index...
    GSI Vector index created successfully: vector_search_crew
    Waiting for index to become available...


### Alternative: Composite Index Configuration

If your agent memory use case requires complex filtering with scalar attributes, you can create a **Composite index** instead by changing the configuration above:

```python
# Alternative: Create a Composite index for filtered memory searches
storage.vector_store.create_index(
    index_type=IndexType.COMPOSITE,  # Instead of IndexType.BHIVE
    index_name=storage.index_name,
    index_description="IVF,SQ8"      # Same quantization settings
)
```

### Test 2: GSI-Optimized Performance

Test the same memory search with BHIVE GSI optimization.


```python
# Test memory search performance with GSI index
print("Testing memory search performance with BHIVE GSI optimization...")
gsi_time = test_memory_search_performance(storage, test_query, "GSI-Optimized Search")
```

    Testing memory search performance with BHIVE GSI optimization...
    
    [GSI-Optimized Search] Testing memory search performance
    [GSI-Optimized Search] Query: 'What did Guardiola say about Manchester City?'
    [GSI-Optimized Search] Memory search completed in 0.5910 seconds
    [GSI-Optimized Search] Found 1 memories
    [GSI-Optimized Search] Top result distance: 0.340142 (lower = more similar)
    [GSI-Optimized Search] Top result preview: Pep Guardiola praised Manchester City's current form, saying 'The team is playing well, we are in a ...


### Test 3: Cache Benefits Testing

Now let's demonstrate how caching can improve performance for repeated queries. **Note**: Caching benefits apply to both baseline and GSI-optimized searches.


```python
# Test cache benefits with a different query to avoid interference
cache_test_query = "How is Manchester City performing in training sessions?"

print("Testing cache benefits with memory search...")
print("First execution (cache miss):")
cache_time_1 = test_memory_search_performance(storage, cache_test_query, "Cache Test - First Run")

print("\nSecond execution (cache hit - should be faster):")
cache_time_2 = test_memory_search_performance(storage, cache_test_query, "Cache Test - Second Run")
```

    Testing cache benefits with memory search...
    First execution (cache miss):
    
    [Cache Test - First Run] Testing memory search performance
    [Cache Test - First Run] Query: 'How is Manchester City performing in training sessions?'
    [Cache Test - First Run] Memory search completed in 0.6076 seconds
    [Cache Test - First Run] Found 1 memories
    [Cache Test - First Run] Top result distance: 0.379242 (lower = more similar)
    [Cache Test - First Run] Top result preview: Pep Guardiola praised Manchester City's current form, saying 'The team is playing well, we are in a ...
    
    Second execution (cache hit - should be faster):
    
    [Cache Test - Second Run] Testing memory search performance
    [Cache Test - Second Run] Query: 'How is Manchester City performing in training sessions?'
    [Cache Test - Second Run] Memory search completed in 0.4745 seconds
    [Cache Test - Second Run] Found 1 memories
    [Cache Test - Second Run] Top result distance: 0.379200 (lower = more similar)
    [Cache Test - Second Run] Top result preview: Pep Guardiola praised Manchester City's current form, saying 'The team is playing well, we are in a ...


### Memory Search Performance Analysis

Let's analyze the memory search performance improvements across all optimization levels:


```python
print("\n" + "="*80)
print("MEMORY SEARCH PERFORMANCE OPTIMIZATION SUMMARY")
print("="*80)

print(f"Phase 1 - Baseline Search (No GSI):     {baseline_time:.4f} seconds")
print(f"Phase 2 - GSI-Optimized Search:         {gsi_time:.4f} seconds")
if cache_time_1 and cache_time_2:
    print(f"Phase 3 - Cache Benefits:")
    print(f"  First execution (cache miss):         {cache_time_1:.4f} seconds")
    print(f"  Second execution (cache hit):         {cache_time_2:.4f} seconds")

print("\n" + "-"*80)
print("MEMORY SEARCH OPTIMIZATION IMPACT:")
print("-"*80)

# GSI improvement analysis
if baseline_time and gsi_time:
    speedup = baseline_time / gsi_time if gsi_time > 0 else float('inf')
    time_saved = baseline_time - gsi_time
    percent_improvement = (time_saved / baseline_time) * 100
    print(f"GSI Index Benefit:      {speedup:.2f}x faster ({percent_improvement:.1f}% improvement)")

# Cache improvement analysis
if cache_time_1 and cache_time_2 and cache_time_2 < cache_time_1:
    cache_speedup = cache_time_1 / cache_time_2
    cache_improvement = ((cache_time_1 - cache_time_2) / cache_time_1) * 100
    print(f"Cache Benefit:          {cache_speedup:.2f}x faster ({cache_improvement:.1f}% improvement)")
else:
    print(f"Cache Benefit:          Variable (depends on query complexity and caching mechanism)")

print(f"\nKey Insights for Agent Memory Performance:")
print(f"• GSI BHIVE indexes provide significant performance improvements for memory search")
print(f"• Performance gains are most dramatic for complex semantic memory queries")
print(f"• BHIVE optimization is particularly effective for agent conversational memory")
print(f"• Combined with proper quantization (SQ8), GSI delivers production-ready performance")
print(f"• These performance improvements directly benefit agent response times and scalability")
```

    
    ================================================================================
    MEMORY SEARCH PERFORMANCE OPTIMIZATION SUMMARY
    ================================================================================
    Phase 1 - Baseline Search (No GSI):     0.6159 seconds
    Phase 2 - GSI-Optimized Search:         0.5910 seconds
    Phase 3 - Cache Benefits:
      First execution (cache miss):         0.6076 seconds
      Second execution (cache hit):         0.4745 seconds
    
    --------------------------------------------------------------------------------
    MEMORY SEARCH OPTIMIZATION IMPACT:
    --------------------------------------------------------------------------------
    GSI Index Benefit:      1.04x faster (4.0% improvement)
    Cache Benefit:          1.28x faster (21.9% improvement)
    
    Key Insights for Agent Memory Performance:
    • GSI BHIVE indexes provide significant performance improvements for memory search
    • Performance gains are most dramatic for complex semantic memory queries
    • BHIVE optimization is particularly effective for agent conversational memory
    • Combined with proper quantization (SQ8), GSI delivers production-ready performance
    • These performance improvements directly benefit agent response times and scalability


**Note on BHIVE GSI Performance:** The BHIVE GSI index may show slower performance for very small datasets (few documents) due to the additional overhead of maintaining the index structure. However, as the dataset scales up, the BHIVE GSI index becomes significantly faster than traditional vector searches. The initial overhead investment pays off dramatically with larger memory stores, making it essential for production agent deployments with substantial conversational history.

## CrewAI Agent Memory Demo

### What is CrewAI Agent Memory?

Now that we've optimized our memory search performance, let's demonstrate how CrewAI agents can leverage this GSI-optimized memory system. CrewAI agent memory enables:

- **Persistent Context**: Agents remember information across conversations and tasks
- **Semantic Recall**: Agents can find relevant memories using natural language queries
- **Collaborative Memory**: Multiple agents can share and build upon each other's memories
- **Performance Benefits**: Our GSI optimizations directly improve agent memory retrieval speed

This demo shows how the memory performance improvements we validated translate to real agent workflows.

### Create Agents with Optimized Memory

Set up CrewAI agents that use our GSI-optimized Couchbase memory storage for fast, contextual memory retrieval.


```python
# Initialize ShortTermMemory with our storage
memory = ShortTermMemory(storage=storage)

# Initialize language model
llm = ChatOpenAI(
    model="gpt-4o",
    temperature=0.7
)

# Create agents with memory
sports_analyst = Agent(
    role='Sports Analyst',
    goal='Analyze Manchester City performance',
    backstory='Expert at analyzing football teams and providing insights on their performance',
    llm=llm,
    memory=True,
    memory_storage=memory
)

journalist = Agent(
    role='Sports Journalist',
    goal='Create engaging football articles',
    backstory='Experienced sports journalist who specializes in Premier League coverage',
    llm=llm,
    memory=True,
    memory_storage=memory
)

# Create tasks
analysis_task = Task(
    description='Analyze Manchester City\'s recent performance based on Pep Guardiola\'s comments: "The team is playing well, we are in a good moment. The way we are training, the way we are playing - I am really pleased."',
    agent=sports_analyst,
    expected_output="A comprehensive analysis of Manchester City's current form based on Guardiola's comments."
)

writing_task = Task(
    description='Write a sports article about Manchester City\'s form using the analysis and Guardiola\'s comments.',
    agent=journalist,
    context=[analysis_task],
    expected_output="An engaging sports article about Manchester City's current form and Guardiola's perspective."
)

# Create crew with memory
crew = Crew(
    agents=[sports_analyst, journalist],
    tasks=[analysis_task, writing_task],
    process=Process.sequential,
    memory=True,
    short_term_memory=memory,  # Explicitly pass our memory implementation
    verbose=True
)
```

### Run Agent Memory Demo


```python
# Run the crew with optimized GSI memory
print("Running CrewAI agents with GSI-optimized memory storage...")
start_time = time.time()
result = crew.kickoff()
execution_time = time.time() - start_time

print("\n" + "="*80)
print("CREWAI AGENT MEMORY DEMO RESULT")
print("="*80)
print(result)
print("="*80)
print(f"\n✅ CrewAI agents completed successfully in {execution_time:.2f} seconds!")
print("✅ Agents used GSI-optimized Couchbase memory storage for fast retrieval!")
print("✅ Memory will persist across sessions for continued learning and context retention!")
```

    Running CrewAI agents with GSI-optimized memory storage...



<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008080; text-decoration-color: #008080">╭──────────────────────────────────────────── Crew Execution Started ─────────────────────────────────────────────╮</span>
<span style="color: #008080; text-decoration-color: #008080">│</span>                                                                                                                 <span style="color: #008080; text-decoration-color: #008080">│</span>
<span style="color: #008080; text-decoration-color: #008080">│</span>  <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">Crew Execution Started</span>                                                                                         <span style="color: #008080; text-decoration-color: #008080">│</span>
<span style="color: #008080; text-decoration-color: #008080">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">Name: </span><span style="color: #008080; text-decoration-color: #008080">crew</span>                                                                                                     <span style="color: #008080; text-decoration-color: #008080">│</span>
<span style="color: #008080; text-decoration-color: #008080">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">ID: </span><span style="color: #008080; text-decoration-color: #008080">38d8c744-17cf-4aef-b246-3ff3a930ca29</span>                                                                       <span style="color: #008080; text-decoration-color: #008080">│</span>
<span style="color: #008080; text-decoration-color: #008080">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">Tool Args: </span>                                                                                                    <span style="color: #008080; text-decoration-color: #008080">│</span>
<span style="color: #008080; text-decoration-color: #008080">│</span>                                                                                                                 <span style="color: #008080; text-decoration-color: #008080">│</span>
<span style="color: #008080; text-decoration-color: #008080">│</span>                                                                                                                 <span style="color: #008080; text-decoration-color: #008080">│</span>
<span style="color: #008080; text-decoration-color: #008080">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span>
</pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
</pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008000; text-decoration-color: #008000">╭────────────────────────────────────────────── 🧠 Retrieved Memory ──────────────────────────────────────────────╮</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>                                                                                                                 <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">Historical Data:</span>                                                                                               <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">- Ensure that the actual output directly addresses the task description and expected output.</span>                   <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">- Include more specific statistical data and recent match examples to support the analysis.</span>                    <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">- Incorporate more direct quotes from Pep Guardiola or other relevant stakeholders.</span>                            <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">- Address potential biases in Guardiola's comments and provide a balanced view considering external opinions.</span>  <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">- Explore deeper tactical analysis to provide more insights into the team's performance.</span>                       <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">- Mention fu...</span>                                                                                                <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>                                                                                                                 <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">╰─────────────────────────────────────────── Retrieval Time: 1503.80ms ───────────────────────────────────────────╯</span>
</pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
</pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800080; text-decoration-color: #800080">╭─────────────────────────────────────────────── 🤖 Agent Started ────────────────────────────────────────────────╮</span>
<span style="color: #800080; text-decoration-color: #800080">│</span>                                                                                                                 <span style="color: #800080; text-decoration-color: #800080">│</span>
<span style="color: #800080; text-decoration-color: #800080">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">Agent: </span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">Sports Analyst</span>                                                                                          <span style="color: #800080; text-decoration-color: #800080">│</span>
<span style="color: #800080; text-decoration-color: #800080">│</span>                                                                                                                 <span style="color: #800080; text-decoration-color: #800080">│</span>
<span style="color: #800080; text-decoration-color: #800080">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">Task: </span><span style="color: #00ff00; text-decoration-color: #00ff00">Analyze Manchester City's recent performance based on Pep Guardiola's comments: "The team is playing </span>    <span style="color: #800080; text-decoration-color: #800080">│</span>
<span style="color: #800080; text-decoration-color: #800080">│</span>  <span style="color: #00ff00; text-decoration-color: #00ff00">well, we are in a good moment. The way we are training, the way we are playing - I am really pleased."</span>         <span style="color: #800080; text-decoration-color: #800080">│</span>
<span style="color: #800080; text-decoration-color: #800080">│</span>                                                                                                                 <span style="color: #800080; text-decoration-color: #800080">│</span>
<span style="color: #800080; text-decoration-color: #800080">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span>
</pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
</pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
</pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008000; text-decoration-color: #008000">╭──────────────────────────────────────────────── Task Completion ────────────────────────────────────────────────╮</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>                                                                                                                 <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #008000; text-decoration-color: #008000; font-weight: bold">Task Completed</span>                                                                                                 <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">Name: </span><span style="color: #008000; text-decoration-color: #008000">bd1a6f7d-9d37-47f0-98ce-2420c3175312</span>                                                                     <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">Agent: </span><span style="color: #008000; text-decoration-color: #008000">Sports Analyst</span>                                                                                          <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">Tool Args: </span>                                                                                                    <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>                                                                                                                 <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>                                                                                                                 <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span>
</pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
</pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008000; text-decoration-color: #008000">╭────────────────────────────────────────────── 🧠 Retrieved Memory ──────────────────────────────────────────────╮</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>                                                                                                                 <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">Historical Data:</span>                                                                                               <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">- Ensure that the article includes direct quotes from Guardiola if possible to enhance credibility.</span>            <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">- Include more detailed statistical analysis or comparisons with previous seasons for a deeper insight into </span>   <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">the team's form.</span>                                                                                               <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">- Incorporate players' and experts' opinions or commentary to provide a well-rounded perspective.</span>              <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">- Add a section discussing future challenges or key upcoming matches for Manchester City.</span>                      <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">- Consider incorporating multimedia elements like images or videos ...</span>                                         <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>                                                                                                                 <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">╰─────────────────────────────────────────── Retrieval Time: 854.27ms ────────────────────────────────────────────╯</span>
</pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
</pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800080; text-decoration-color: #800080">╭─────────────────────────────────────────────── 🤖 Agent Started ────────────────────────────────────────────────╮</span>
<span style="color: #800080; text-decoration-color: #800080">│</span>                                                                                                                 <span style="color: #800080; text-decoration-color: #800080">│</span>
<span style="color: #800080; text-decoration-color: #800080">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">Agent: </span><span style="color: #00ff00; text-decoration-color: #00ff00; font-weight: bold">Sports Journalist</span>                                                                                       <span style="color: #800080; text-decoration-color: #800080">│</span>
<span style="color: #800080; text-decoration-color: #800080">│</span>                                                                                                                 <span style="color: #800080; text-decoration-color: #800080">│</span>
<span style="color: #800080; text-decoration-color: #800080">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">Task: </span><span style="color: #00ff00; text-decoration-color: #00ff00">Write a sports article about Manchester City's form using the analysis and Guardiola's comments.</span>         <span style="color: #800080; text-decoration-color: #800080">│</span>
<span style="color: #800080; text-decoration-color: #800080">│</span>                                                                                                                 <span style="color: #800080; text-decoration-color: #800080">│</span>
<span style="color: #800080; text-decoration-color: #800080">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span>
</pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
</pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
</pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"></pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008000; text-decoration-color: #008000">╭──────────────────────────────────────────────── Task Completion ────────────────────────────────────────────────╮</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>                                                                                                                 <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #008000; text-decoration-color: #008000; font-weight: bold">Task Completed</span>                                                                                                 <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">Name: </span><span style="color: #008000; text-decoration-color: #008000">8bcffe0e-5a64-4e12-8207-e0f8701d847b</span>                                                                     <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">Agent: </span><span style="color: #008000; text-decoration-color: #008000">Sports Journalist</span>                                                                                       <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>  <span style="color: #c0c0c0; text-decoration-color: #c0c0c0">Tool Args: </span>                                                                                                    <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>                                                                                                                 <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">│</span>                                                                                                                 <span style="color: #008000; text-decoration-color: #008000">│</span>
<span style="color: #008000; text-decoration-color: #008000">╰─────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯</span>
</pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
</pre>




<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">
</pre>



    
    ================================================================================
    CREWAI AGENT MEMORY DEMO RESULT
    ================================================================================
    **Manchester City’s Impeccable Form: A Reflection of Guardiola’s Philosophy**
    
    Manchester City has been turning heads with their exceptional form under the astute guidance of Pep Guardiola. The team’s recent performances have not only aligned seamlessly with their manager’s philosophy but have also placed them in a formidable position across various competitions. Guardiola himself expressed his satisfaction, stating, "The team is playing well, we are in a good moment. The way we are training, the way we are playing - I am really pleased."
    
    City’s prowess has been evident both domestically and in international arenas. A key factor in their success is their meticulous training regimen, which has fostered strategic flexibility, a hallmark of Guardiola’s management. Over the past few matches, Manchester City has consistently maintained a high possession rate, often exceeding 60%. This high possession allows them to control the tempo and dictate the flow of the game, a crucial component of their strategy.
    
    A recent standout performance was their dominant victory against a top Premier League rival. In this match, City showcased their attacking capabilities and defensive solidity, managing to keep a clean sheet. The contributions of key players like Kevin De Bruyne and Erling Haaland have been instrumental. De Bruyne’s creativity and passing range have opened multiple avenues for attack, while Haaland’s clinical finishing has consistently troubled defenses.
    
    Guardiola’s system, which relies heavily on positional play and fluid movement, has been a critical factor in their ability to break down opposition defenses with quick, incisive passes. The team’s pressing game has also been a cornerstone of their strategy, allowing them to win back possession high up the pitch and quickly transition to attack.
    
    Despite the glowing form and Guardiola’s positive outlook, it’s important to acknowledge potential areas for improvement. While their attack is formidable, City has shown occasional vulnerability to counter-attacks, particularly when their full-backs are positioned high up the field. Addressing these defensive transitions will be crucial, especially against teams with quick counter-attacking capabilities.
    
    Looking forward, Manchester City’s current form is a strong foundation for upcoming challenges, including key fixtures in the Premier League and the knockout stages of the UEFA Champions League. Maintaining this performance level will be essential as they pursue multiple titles. The team’s depth, strategic versatility, and Guardiola’s leadership will be decisive factors in sustaining their momentum.
    
    In conclusion, Manchester City is indeed in a "good moment," as Guardiola aptly puts it. Their recent performances reflect a well-oiled machine operating at high efficiency. However, the team must remain vigilant about potential weaknesses and continue adapting tactically to ensure their current form translates into long-term success. As they aim for glory, the synergy between Guardiola’s strategic mastermind and the players’ execution will undoubtedly be the key to their triumphs.
    ================================================================================
    
    ✅ CrewAI agents completed successfully in 37.60 seconds!
    ✅ Agents used GSI-optimized Couchbase memory storage for fast retrieval!
    ✅ Memory will persist across sessions for continued learning and context retention!


## Memory Retention Testing

### Verify Memory Storage and Retrieval

Test that our agents successfully stored memories and can retrieve them using semantic search.


```python
# Wait for memories to be stored
time.sleep(2)

# List all documents in the collection
try:
    # Query to fetch all documents of this memory type
    query_str = f"SELECT META().id, * FROM `{storage.bucket_name}`.`{storage.scope_name}`.`{storage.collection_name}` WHERE memory_type = $type"
    query_result = storage.cluster.query(query_str, type=storage.type)
    
    print(f"\nAll memory entries in Couchbase:")
    print("-" * 80)
    for i, row in enumerate(query_result, 1):
        doc_id = row.get('id')
        memory_id = row.get(storage.collection_name, {}).get('memory_id', 'unknown')
        content = row.get(storage.collection_name, {}).get('text', '')[:100] + "..."  # Truncate for readability
        
        print(f"Entry {i}: {memory_id}")
        print(f"Content: {content}")
        print("-" * 80)
except Exception as e:
    print(f"Failed to list memory entries: {str(e)}")

# Test memory retention
memory_query = "What is Manchester City's current form according to Guardiola?"
memory_results = storage.search(
    query=memory_query,
    limit=5,  # Increased to see more results
    score_threshold=0.0  # Lower threshold to see all results
)

print("\nMemory Search Results:")
print("-" * 80)
for result in memory_results:
    print(f"Context: {result['context']}")
    print(f"Distance: {result['distance']} (lower = more similar)")
    print("-" * 80)

# Try a more specific query to find agent interactions
interaction_query = "Manchester City playing style analysis tactical"
interaction_results = storage.search(
    query=interaction_query,
    limit=3,
    score_threshold=0.0
)

print("\nAgent Interaction Memory Results:")
print("-" * 80)
if interaction_results:
    for result in interaction_results:
        print(f"Context: {result['context'][:200]}...")  # Limit output size
        print(f"Distance: {result['distance']} (lower = more similar)")
        print("-" * 80)
else:
    print("No interaction memories found. This is normal if agents haven't completed tasks yet.")
    print("-" * 80)
```

    
    All memory entries in Couchbase:
    --------------------------------------------------------------------------------
    
    Memory Search Results:
    --------------------------------------------------------------------------------
    Context: Pep Guardiola praised Manchester City's current form, saying 'The team is playing well, we are in a good moment. The way we are training, the way we are playing - I am really pleased.'
    Distance: 0.285379886892123 (lower = more similar)
    --------------------------------------------------------------------------------
    Context: Manchester City's recent performance analysis under Pep Guardiola reflects a team in strong form and alignment with the manager's philosophy. Guardiola's comments, "The team is playing well, we are in a good moment. The way we are training, the way we are playing - I am really pleased," suggest a high level of satisfaction with both the tactical execution and the overall team ethos on the pitch.
    
    In recent matches, Manchester City has demonstrated their prowess in both domestic and international competitions. This form can be attributed to their meticulous training regimen and strategic flexibility, hallmarks of Guardiola's management style. Over the past few matches, City has maintained a high possession rate, often exceeding 60%, which allows them to control the tempo and dictate the flow of the game. Their attacking prowess is underscored by their goal-scoring statistics, often leading the league in goals scored per match.
    
    One standout example of their performance is their recent dominant victory against a top Premier League rival, where they not only showcased their attacking capabilities but also their defensive solidity, keeping a clean sheet. Key players such as Kevin De Bruyne and Erling Haaland have been instrumental, with De Bruyne's creativity and passing range creating numerous opportunities, while Haaland's clinical finishing has consistently troubled defenses.
    
    Guardiola's system relies heavily on positional play and fluid movement, which has been evident in the team's ability to break down opposition defenses through quick, incisive passes. The team's pressing game has also been a critical component, often winning back possession high up the pitch and quickly transitioning to attack.
    
    Despite Guardiola's positive outlook, potential biases in his comments might overlook some areas needing improvement. For instance, while their attack is formidable, there have been instances where the team has shown vulnerability to counter-attacks, particularly when full-backs are pushed high up the field. Addressing these defensive transitions could be crucial, especially against teams with quick, counter-attacking capabilities.
    
    Looking ahead, Manchester City's current form sets a strong foundation for upcoming challenges, including key fixtures in the Premier League and the knockout stages of the UEFA Champions League. Maintaining this level of performance will be critical as they pursue multiple titles. The team's depth, strategic versatility, and Guardiola's leadership are likely to be decisive factors in sustaining their momentum.
    
    In summary, Manchester City is indeed in a "good moment," as Guardiola states, with their recent performances reflecting a well-oiled machine operating at high efficiency. However, keeping a vigilant eye on potential weaknesses and continuing to adapt tactically will be essential to translating their current form into long-term success.
    Distance: 0.22963345721993045 (lower = more similar)
    --------------------------------------------------------------------------------
    Context: **Manchester City’s Impeccable Form: A Reflection of Guardiola’s Philosophy**
    
    ... (output truncated for brevity)


## Conclusion

You've successfully implemented a custom memory backend for CrewAI agents using Couchbase GSI vector search!
